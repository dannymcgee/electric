@let viewRect = (contentRect$ | async);
@let glyphToCanvas = (glyphToCanvas$ | async);
@let canvasToGlyph = (canvasToGlyph$ | async);
@let family = (_familyService.family$ | async);

@if (viewRect && glyphToCanvas && canvasToGlyph && family) {
	<canvas g-canvas class="canvas">
		@switch (activeTool) {
			@case ("pan") {
				<g-path
					[outline]="glyph.outline"
					[transform]="glyphToCanvas"
					[fill]="theme.getHex('foreground', 50)"
				/>
			}
			@case ("select") {
				<g-contour-editor
					[glyph]="glyph"
					[outline]="glyph.outline"
					[metrics]="family"
					[viewRect]="viewRect"
					[glyphToCanvas]="glyphToCanvas"
					[canvasToGlyph]="canvasToGlyph"
				/>
			}
			@case ("pen") {
				<g-pen-tool
					[glyph]="glyph"
					[outline]="glyph.outline"
					[metrics]="family"
					[viewRect]="viewRect"
					[glyphToCanvas]="glyphToCanvas"
					[canvasToGlyph]="canvasToGlyph"
					(toolVariantChange)="setPenCursorVariant($event)"
				/>
			}
		}
	</canvas>

	<div class="ui-overlay">
		<div class="tool-palette">
			<div role="button"
				class="tool contour-editor"
				[class.active]="activeTool === 'select'"

				[elxTooltip]="toolPaletteTooltip"
				[elxTooltipContext]="{
					name: 'Select / Move',
					keybind: activeTool === 'pen' ? 'Q or Hold Ctrl' : 'Q'
				}"
				elxTooltipPosition="right"

				keybind="Q"
				(click)="activeTool = passiveTool = 'select'"
			>
				<elx-icon icon="Pointer" />
			</div>
			<div role="button"
				class="tool pen"
				[class.active]="activeTool === 'pen'"

				[elxTooltip]="toolPaletteTooltip"
				[elxTooltipContext]="{
					name: 'Pen Tool',
					keybind: 'W'
				}"
				elxTooltipPosition="right"

				keybind="W"
				(click)="activeTool = passiveTool = 'pen'"
			>
				<elx-icon icon="PenTool" />
			</div>
			<div role="button"
				class="tool pan"
				[class.active]="activeTool === 'pan'"

				[elxTooltip]="toolPaletteTooltip"
				[elxTooltipContext]="{
					name: 'Pan View',
					keybind: 'Hold Spacebar'
				}"
				elxTooltipPosition="right"

				(click)="activeTool = 'pan'"
			>
				<elx-icon icon="MoveAlt" />
			</div>
		</div>
	</div>
}

<ng-template #toolPaletteTooltip
	let-name="name"
	let-keybind="keybind"
>
	<div class="tooltip">
		<span class="tooltip__name">{{ name }}</span>
		@if (keybind) {
			<span class="tooltip__keybind">({{ keybind }})</span>
		}
	</div>
</ng-template>
