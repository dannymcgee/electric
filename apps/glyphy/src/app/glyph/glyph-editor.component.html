<svg #svgRef class="glyph"
	[gViewBox]="(_viewBox$ | async)"
>
	<g g-glyph-metrics
		class="metrics"
		*ngIf="(_viewBox$ | async) as viewBox"
		[glyph]="glyph"
		[viewBox]="viewBox"
		[gTransform]="renderTransform"
		[lineThickness]="metricsThickness"
		[scaleFactor]="_scaleFactor"
	/>

	<g class="pointer" *ngIf="_pointer">
		<line
			*ngIf="_modifiers.includes(ModifierKey.Control)"
			[attr.x1]="_pointer.x"
			[attr.x2]="_pointer.x"
			y1="-10000"
			y2="10000"
		/>
		<text
			x="16"
			y="32"
			[gTransform]="_clientToView"
		>
			X: {{ _pointerCoords?.x | number : '1.0-0' }}
		</text>

		<line
			*ngIf="_modifiers.includes(ModifierKey.Control)"
			x1="-10000"
			x2="10000"
			[attr.y1]="_pointer.y"
			[attr.y2]="_pointer.y"
		/>
		<text
			x="16"
			y="48"
			[gTransform]="_clientToView"
		>
			Y: {{ _pointerCoords?.y | number : '1.0-0' }}
		</text>
	</g>

	<path class="outline"
		[attr.d]="glyph.outline?.svg"
		[gTransform]="renderTransform"
	/>

	<g class="points"
		[gTransform]="renderTransform"
	>
		<g class="contour"
			*ngFor="let c of glyph.outline?.contours
				let ci = index"
		>
			<ng-container
				*ngFor="let p of c.points
					let pi = index
					let isFirst = first
					let isLast = last
					trackBy: trackByIndex"
			>
				<!-- Draw the connecting line if it's inferred -->
				<line class="outline"
					*ngIf="isLast && c.closed
						&& (p.x !== c.points[0].x || p.y !== c.points[0].y)
						&& !p.handle_out"
					[attr.x1]="p.x"
					[attr.y1]="p.y"
					[attr.x2]="c.points[0].x"
					[attr.y2]="c.points[0].y"
				/>
				<!-- Editable control points -->
				<g *ngIf="!c.last?.hidden || (!isFirst && !isLast)"
					[g-control-point]="p"
					[smooth]="p.smooth"
					[scaleFactor]="_scaleFactor"
					[clientToGlyphCoords]="clientToGlyphCoords"
					[clientToView]="_clientToView"
					(update)="updatePoint(ci, pi, $event)"
				></g>
				<g *ngIf="c.last?.hidden && isLast"
					[g-control-point]="c.points[0]"
					first
					[smooth]="c.points[0].smooth"
					[scaleFactor]="_scaleFactor"
					[clientToGlyphCoords]="clientToGlyphCoords"
					[clientToView]="_clientToView"
					(update)="updatePoint(ci, 0, $event)"
				></g>

			</ng-container>
		</g>
	</g>
</svg>
